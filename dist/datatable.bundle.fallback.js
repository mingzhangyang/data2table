"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var DataTable=function(){function d(e,t){var a=new Map,r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done);r=!0){var c=i.value[t];"object"===_typeof(c)&&(c=c.valueForFaceting);var s=a.get(c);void 0===s?a.set(c,1):a.set(c,s+1)}}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}var d=[],u=!0,m=!1,f=void 0;try{for(var h,p=a[Symbol.iterator]();!(u=(h=p.next()).done);u=!0){var g=_slicedToArray(h.value,2),v=g[0],b=g[1];d.push({facetType:"value",facetValue:v,count:b})}}catch(e){m=!0,f=e}finally{try{u||null==p.return||p.return()}finally{if(m)throw f}}return d.sort(function(e,t){return e.count>t.count?-1:e.count<t.count?1:e.facetValue>t.facetValue?-1:1}),d}function f(e,t){var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=t[Symbol.iterator]();!(r=(i=l.next()).done);r=!0){var c=i.value,s={name:c};s.facets=d(e,c),a.push(s)}}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}function h(e,t){if(e===t)return!0;if(Object.prototype.toString.call(e)!==Object.prototype.toString.call(t))return!1;var a=Object.keys(e),r=Object.keys(t);if(a.length!==r.length)return!1;for(var n=0,o=a;n<o.length;n++){var i=o[n],l=e[i],c=t[i];if(Object.prototype.toString.call(l)!==Object.prototype.toString.call(c))return!1;if("object"===_typeof(l)){if(!h(l,c))return!1}else if(l!==c)return!1}return!0}var s=200,u=[1e3,800,600,400,s],n=function(){function c(e,t){if(_classCallCheck(this,c),!Array.isArray(e))throw new TypeError("an array of objects expected");if("[object Object]"!==Object.prototype.toString.call(e[0]))throw new TypeError("an array of objects expected");if(this.dataIsComplete=t.dataIsComplete,this.dataIsComplete)this.data=e,this.batchSize=e.length,this.cache={data:this.data.slice(),queryObject:{filter:{},sort:{}},range:[0,this.batchSize],totalCount:e.length},this.fetchData=function(e){var t=e.start,a=e.limit,r=e.filter,n=e.sort,o=this.data.slice();if(r)for(var i=Object.keys(r),l=function(){var t=s[c];o=Array.isArray(r[t])?o.filter(function(e){return"object"===_typeof(e[t])?r[t].includes(e[t].valueForFiltering):r[t].includes(e[t])}):o.filter(function(e){return"object"===_typeof(e[t])?r[t]===e[t].valueForFiltering:r[t]===e[t]})},c=0,s=i;c<s.length;c++)l();if(n){var d=Object.keys(n)[0],u=n[d];1===u?o.sort(function(e,t){return"object"===_typeof(e[d])&&"object"===_typeof(t[d])?e[d].valueForSorting<t[d].valueForSorting?-1:1:e[d]<t[d]?-1:1}):-1===u&&o.sort(function(e,t){return"object"===_typeof(e[d])&&"object"===_typeof(t[d])?e[d].valueForSorting<t[d].valueForSorting?1:-1:e[d]<t[d]?1:-1})}return{data:o.slice(t,t+a),totalCount:o.length}}.bind(this);else{if(e.length<s)throw"dataIsComplete is set false, but the provided dataset contains less than ".concat(s," rows");var a=!0,r=!1,n=void 0;try{for(var o,i=u[Symbol.iterator]();!(a=(o=i.next()).done);a=!0){var l=o.value;if(e.length>=l){this.data=e.slice(0,l),this.batchSize=l,this.cache={data:this.data.slice(),queryObject:{filter:{},sort:{}},range:[0,this.batchSize]};break}}}catch(e){r=!0,n=e}finally{try{a||null==i.return||i.return()}finally{if(r)throw n}}if(!t.fetchData)throw"data is not complete, a fetchData function is required";if("function"!=typeof t.fetchData)throw new TypeError("fetchData should be a function");if(!t.totalCount)throw"data is not complete, a totalCount property indicating total rows is missing";this.fetchData=t.fetchData,this.cache.totalCount=t.totalCount}}return _createClass(c,[{key:"serve",value:function(r){var n,o,i,l,c,s,d,u,m;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(r.facets))return e.abrupt("return",f(this.data,r.facets));e.next=2;break;case 2:if(n=r.start?r.start:0,o=r.limit?r.limit:10,i=r.filter?r.filter:{},l=r.sort?r.sort:{},t=r,a=this.cache.queryObject,h(t.sort,a.sort)&&h(t.filter,a.filter)&&n>=this.cache.range[0]&&n<this.cache.range[1])return c=n-this.cache.range[0],e.abrupt("return",{data:this.cache.data.slice(c,c+o),totalCount:this.cache.totalCount});e.next=9;break;case 9:return s=n-n%this.batchSize,d={start:s,limit:this.batchSize,filter:i,sort:l},u=null,e.prev=12,e.next=15,regeneratorRuntime.awrap(this.fetchData(d));case 15:u=e.sent,e.next=21;break;case 18:throw e.prev=18,e.t0=e.catch(12),e.t0;case 21:return this.cache.data=u.data,this.cache.queryObject=d,this.cache.range=[s,s+this.batchSize],this.cache.totalCount=u.totalCount,m=n-s,e.abrupt("return",{data:this.cache.data.slice(m,m+o),totalCount:u.totalCount});case 27:case"end":return e.stop()}var t,a},null,this,[[12,18]])}}]),c}(),o=function(){function e(){_classCallCheck(this,e),this.rowsPerPage=10,this.currentPageNumber=1,this.sort={},this.filter={},this.filterStatus={}}return _createClass(e,[{key:"extractFilter",value:function(){for(var e={},t=0,a=Object.keys(this.filterStatus);t<a.length;t++){var r=a[t],n=this.filterStatus[r].filter(function(e){return e.selected});0<n.length&&(e[r]=n.map(function(e){return e.facetValue}))}return this.filter=e}},{key:"getStart",value:function(){return(this.currentPageNumber-1)*this.rowsPerPage}},{key:"queryObject",value:function(){return{start:(this.currentPageNumber-1)*this.rowsPerPage,limit:this.rowsPerPage,filter:this.extractFilter(),sort:this.sort}}}]),e}(),t={highlight:function(e){return"<mark>".concat(e,"</mark>")},addLink:function(e){return'<a href="'.concat(e.link,'">').concat(e.text,"</a>")},bold:function(e){return"<strong>".concat(e,"</strong>")},colorText:function(e){return'<span style="color: '.concat(e.color,'">').concat(e.text,"</span>")}};function x(e){return t[e]}function le(e,t){var a=1<arguments.length&&void 0!==t?t:",";if(!Array.isArray(e))throw new TypeError("an array of objects expected");if(0===e.length)return"";var r=Object.keys(e[0]),n=r.map(function(e){return e.includes(a)?'"'.concat(e,'"'):e}).join(a)+"\n",o=!0,i=!1,l=void 0;try{for(var c,s=function(){var t=c.value,e=r.map(function(e){return t[e]});e=e.map(function(e){return e.includes(a)?'"'.concat(e,'"'):e}),n+=e.join(a)+"\n"},d=e[Symbol.iterator]();!(o=(c=d.next()).done);o=!0)s()}catch(e){i=!0,l=e}finally{try{o||null==d.return||d.return()}finally{if(i)throw l}}return n}function T(e){switch(_typeof(e)){case"number":return e+"";case"string":return e;case"boolean":return e+"";case"object":return Array.isArray(e)?e.join(", "):null===e?"N/A":JSON.stringify(e);default:return"N/A"}}function i(e,t,a){var r=!0,n=!1,o=void 0;try{for(var i,l=e._columnSetting.shownColumns[Symbol.iterator]();!(r=(i=l.next()).done);r=!0){var c=i.value;if(e._columnSetting.colModel[c].formatter)if("string"==typeof e._columnSetting.colModel[c].formatter){if(!x(e._columnSetting.colModel[c].formatter))throw new Error("formatter not recognized");e._columnSetting.colModel[c].formatter=x(e._columnSetting.colModel[c].formatter)}else if("function"!=typeof e._columnSetting.colModel[c].formatter)throw new Error("Invalid formatter for "+c)}}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}if("string"!=typeof e._targetId||!e._targetId)throw new Error("an element id expected");var s=document.getElementById(e._targetId+"-table-section");if(!s)throw new Error("failed to locate the table");var d=s.getElementsByTagName("tbody")[0];d._data=null,d.parentNode.removeChild(d);var u=document.createDocumentFragment();d=u.appendChild(document.createElement("tbody"));for(var m=0;m<t.length;m++){var f=t[m],h=d.appendChild(document.createElement("tr"));switch(e._configuration.firstColumnType){case"number":var p=e._stateManager.getStart()+1,g=h.appendChild(document.createElement("td"));g.innerText=p+m,g.classList.add("table-row-index-column");break;case"checkbox":h.appendChild(document.createElement("td")).classList.add("table-row-index-column","table-row-checkbox-column")}var v=!0,b=!1,y=void 0;try{for(var _,w=e._columnSetting.shownColumns[Symbol.iterator]();!(v=(_=w.next()).done);v=!0){var C=_.value,E=h.appendChild(document.createElement("td"));if(e._columnSetting.colModel[C].formatter){var L=e._columnSetting.colModel[C].formatter(f[C]);switch(_typeof(L)){case"string":E.innerHTML=L;break;case"object":E.appendChild(L);break;default:E.innerText="invalid customized formatter"}}else E.innerText=T(f[C]);e._columnSetting.colModel[C].align&&(E.style.textAlign=e._columnSetting.colModel[C].align)}}catch(e){b=!0,y=e}finally{try{v||null==w.return||w.return()}finally{if(b)throw y}}}if(s.appendChild(u),e._configuration.pagination){var S=document.getElementById(e._targetId+"-table-page-number-current");S.value=e._stateManager.currentPageNumber,S.setAttribute("aria-label","current page is "+S.value);var k=document.getElementById(e._targetId+"-table-page-number-total");k.value=a,k.setAttribute("aria-label","all ".concat(a," pages"))}}function m(e){var t=document.getElementById(e._targetId+"-filter-section");if(!t)throw new Error("Creating filter section failed.");for(;t.lastChild;)t.removeChild(t.lastChild);var a=Object.keys(e._stateManager.filterStatus);if(0!==a.length){var r=document.getElementById(e._targetId+"-filter-viz-download-buttons-wrapper");if(0===r.getElementsByClassName("filter-section-control-button").length){var n=r.insertBefore(document.createElement("div"),r.firstElementChild);n.classList.add("table-top-button","filter-section-control-button"),n.appendChild(document.createTextNode("Filters")),n.setAttribute("role","button"),n.setAttribute("aria-label","filter button"),n.addEventListener("click",function(){document.getElementById(e._targetId).classList.toggle("filter-section-active")}),n.classList.add("filter-ready-signal"),setTimeout(function(){n.classList.remove("filter-ready-signal")},2e3)}var o=document.createDocumentFragment(),i=o.appendChild(document.createElement("table"));i.classList.add("filter-section-table");for(var l=0,c=a;l<c.length;l++){var s=c[l],d=i.appendChild(document.createElement("tr"));d.classList.add("filter-section-row"),d.filterName=s;var u=d.appendChild(document.createElement("td"));u.classList.add("filter-name"),u.appendChild(document.createTextNode(e._columnSetting.colModel[s].label?e._columnSetting.colModel[s].label:s)),(u=d.appendChild(document.createElement("td"))).classList.add("filter-values"),u.classList.add("unfold-fold-fold");for(var m=0;m<e._stateManager.filterStatus[s].length;m++){var f=e._stateManager.filterStatus[s][m],h=u.appendChild(document.createElement("span"));h.classList.add("filter-value"),9<m&&h.classList.add("filter-value-hidden");var p=h.appendChild(document.createElement("input"));p.type="checkbox";var g="".concat(e._targetId,"-filter-value-").concat(s,"-value-").concat(m);p.id=g,p.counterpart=f,p.addEventListener("change",function(){this.counterpart.selected=this.checked,e._filterData()});var v=h.appendChild(document.createElement("label"));if(v.setAttribute("for",g),v.appendChild(document.createTextNode("".concat(f.facetValue," (").concat(f.count,")"))),m>e._configuration.maxNumOfFacets-1){var b=u.appendChild(document.createElement("span"));b.classList.add("filter-value-hidden"),b.classList.add("filter-value-overflow-message"),b.innerText="(showing the first 50 items only)",e._notifyStatus({type:"alert",message:"Too many facets, only a partial list is shown in the Filter section"});break}}if(10<e._stateManager.filterStatus[s].length){var y=u.appendChild(document.createElement("span"));y.classList.add("unfold-fold-ctrl"),y.addEventListener("click",function(e){e.target.parentNode.classList.toggle("unfold-fold-fold")})}}t.appendChild(o)}else console.error("No filters found.")}return function(){function r(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{dataIsComplete:!0};if(_classCallCheck(this,r),"string"!=typeof t||!t)throw new TypeError("target id should be a non-empty string");this._targetId=t,this._dataManager=new n(e,a),this._stateManager=new o,this._columnSetting=function(e){var t={colModel:{},allColumns:[]},a=new Set,r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done);r=!0)for(var c=i.value,s=Object.keys(c),d=0,u=s;d<u.length;d++){var m=u[d];a.add(m)}}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}var f=!0,h=!1,p=void 0;try{for(var g,v=a[Symbol.iterator]();!(f=(g=v.next()).done);f=!0){var b=g.value;t.colModel[b]={name:b,label:b,tips:"",sortable:!1,hidden:!1,width:"",align:"",formatter:void 0},t.allColumns.push(b)}}catch(e){h=!0,p=e}finally{try{f||null==v.return||v.return()}finally{if(h)throw p}}return t.shownColumns=t.allColumns,t.hiddenColumns=[],t}(this._dataManager.data),this._configuration={caption:"",maxNumOfFacets:50,layout:{download:!1,filter:!1,chart:!1,search:!1,column_selector:!1},firstColumnType:void 0,scheme:"default",fileName:a.fileName?a.fileName:"data",urlForDownloading:a.urlForDownloading,columnsToDownload:a.columnsToDownload,dataToDownload:a.dataToDownload,stickyHeader:a.stickyHeader,pagination:void 0===a.pagination||a.pagination},this._uid="my-1535567872393-product"}return _createClass(r,[{key:"setRowsPerPage",value:function(e){if("number"!=typeof e||e<0)throw new Error("a natural number expected");if(![5,10,20,50,100,200].includes(e))throw"".concat(e," is invalid");this._stateManager.rowsPerPage=e}},{key:"setFormatter",value:function(e,t){if("string"!=typeof e||!this._columnSetting.colModel[e])throw new Error("Column name ".concat(e," not recognized."));if("string"!=typeof t){if("function"!=typeof t)throw new Error("A predefined formatter name or custom function expected.");this._columnSetting.colModel[e].formatter=t}else{var a=x[t];if(!a)throw new Error("The formatter name ".concat(t," not recognized."));this._columnSetting.colModel[e].formatter=a}}},{key:"configureColumn",value:function(e,t){if(!this._columnSetting.colModel[e])throw new Error("Column name not recognized.");if("object"!==_typeof(t))throw new Error("An object describing the column expected.");Object.assign(this._columnSetting.colModel[e],t)}},{key:"configureLayout",value:function(e,t){if("string"!=typeof e)throw"Invalid property: "+e;switch(e.toUpperCase()){case"DOWNLOAD":this._configuration.layout.download=t;break;case"FILTER":this._configuration.layout.filter=t;break;case"CHART":this._configuration.layout.chart=t;break;case"SEARCH":this._configuration.layout.search=t;break;case"COLUMN_SELECTOR":this._configuration.layout.selectColumns=t;break;default:return console.error("Property not recognized!"),void console.error("Expect: download | search | filter | chart | column_selector")}console.log("Configuration updated.")}},{key:"setShownColumns",value:function(e){var t=[],a=!0,r=!1,n=void 0;try{for(var o,i=e[Symbol.iterator]();!(a=(o=i.next()).done);a=!0){var l=o.value;if(!this._columnSetting.allColumns.includes(l))throw"invalid column name found when set shown columns";t.push(l)}}catch(e){r=!0,n=e}finally{try{a||null==i.return||i.return()}finally{if(r)throw n}}this._columnSetting.shownColumns=t,this._columnSetting.hiddenColumns=this._columnSetting.allColumns.filter(function(e){return!t.includes(e)})}},{key:"addFilter",value:function(e,t){if(!this._columnSetting.shownColumns.includes(e))throw"the column name ".concat(e," is invalid");this._stateManager.filterStatus[e]=[],this._configuration.layout.filter=!0}},{key:"setCaption",value:function(e){"string"==typeof e&&0<e.length&&(this._configuration.caption=e)}},{key:"setFirstColumnType",value:function(e,t){if("string"!=typeof e)throw new TypeError("a string expected to set the type of the first column");switch(e.toLowerCase()){case"number":this._configuration.firstColumnType="number";break;case"checkbox":this._configuration.firstColumnType="checkbox";break;case"image":if(this._configuration.firstColumnType="image","img"!==t.tagName)throw new TypeError("an img element descriptor expected");this._configuration.firstColumnFormatter=t.formatter;break;case"custom":this._configuration.firstColumnType="custom";var a=document.createElement(t.tagName);if("[object HTMLUnknownElement]"===Object.prototype.toString.call(a))throw"invalid tag name to create custom element";this._configuration.firstColumnFormatter=t.formatter;break;default:throw new TypeError("valid types: number, checkbox, image, custom")}}},{key:"generate",value:function(){!function(x){var e=document.getElementById(x._targetId),t=document.createElement("div");e.parentNode.insertBefore(t,e),e.parentNode.removeChild(e),t.id=x._targetId,t.classList.add(x._uid,x._configuration.scheme),t.setAttribute("role","table");var a=document.createDocumentFragment(),r=a.appendChild(document.createElement("div"));if(r.classList.add("search-bar-panel"),x._configuration.search){var n=r.appendChild(document.createElement("div"));n.id=x._targetId+"-search-bar",n.classList.add("search-bar-wrapper");var o=n.appendChild(document.createElement("input"));o.type="search",o.id=x._targetId+"-search-box",o.classList.add("search-box"),o.setAttribute("aria-label","search box"),o.addEventListener("focus",function(){this.parentElement.classList.remove("search-hints-active")});var i=n.appendChild(document.createElement("label"));i.htmlFor=o.id,i.classList.add("label-for-search-box"),i.setAttribute("role","button"),i.setAttribute("aria-label","search button"),i.appendChild(document.createTextNode("Search"));var l=n.appendChild(document.createElement("span"));l.classList.add("question-mark"),l.setAttribute("role","button"),l.setAttribute("aria-label","hints for search syntax"),l.addEventListener("click",function(){this.parentElement.classList.add("search-hints-active")});var c=n.appendChild(document.createElement("div"));c.classList.add("search-hints-wrapper"),c.setAttribute("role","table");var s=c.appendChild(document.createElement("p"));s.innerText='Syntax: "column name":[[operator] value] [AND | OR] ["column name"[:[operator]value]]',s.setAttribute("role","row");var d=c.appendChild(document.createElement("p"));d.appendChild(document.createTextNode("e.g. ")),d.appendChild(document.createElement("span")).appendChild(document.createTextNode('"length": > 120')),d.appendChild(document.createElement("span")).appendChild(document.createTextNode(";")),d.appendChild(document.createElement("span")).appendChild(document.createTextNode('"height": 80 AND "width": 100')),d.setAttribute("role","row")}var u=a.appendChild(document.createElement("div"));if(u.id=x._targetId+"-filter-viz-download-buttons-wrapper",u.classList.add("filter-viz-download-buttons-wrapper"),x._configuration.filter){var m=u.appendChild(document.createElement("div"));m.classList.add("table-top-button","filter-section-control-button"),m.appendChild(document.createTextNode("Filters")),m.setAttribute("role","button"),m.setAttribute("aria-label","filter button"),m.addEventListener("click",function(){document.getElementById(x._targetId).classList.toggle("filter-section-active")})}if(x._configuration.chart){var f=u.appendChild(document.createElement("div"));f.classList.add("table-top-button"),f.classList.add("viz-section-control-button"),f.appendChild(document.createTextNode("Visualize")),f.addEventListener("click",function(){document.getElementById(x._targetId).classList.toggle("viz-section-active")})}if(x._configuration.download){var h=u.appendChild(document.createElement("div"));h.classList.add("table-top-button","download-control-button");var p=document.createElement("span");p.appendChild(document.createTextNode("Download")),h.appendChild(p),h.setAttribute("role","button"),h.setAttribute("aria-label","download button");var g=document.createElement("form");g.classList.add("data-table-download-type-options");for(var v=function(){var k=y[b],e=document.createElement("span"),t=e.appendChild(document.createElement("input"));t.type="radio",t.value=k,t.id=x._targetId+"-data-table-download-type-option-"+k,t.classList.add("data-table-download-type-option"),t.name="data-table-download-type",e.appendChild(t);var a=document.createElement("label");a.classList.add("data-table-download-type-option-label"),a.appendChild(document.createTextNode(k)),a.htmlFor="data-table-download-type-option "+k,a.addEventListener("click",function(){var e=document.createElement("a");if(e.setAttribute("download",x._configuration.fileName+"."+k.toLowerCase()),x._configuration.urlForDownloading){var t="".concat(x._configuration.urlForDownloading,"&type=").concat(k.toLowerCase()),a=x._configuration.columnsToDownload?x._configuration.columnsToDownload:x._columnSetting.shownColumns,r=!0,n=!1,o=void 0;try{for(var i,l=a[Symbol.iterator]();!(r=(i=l.next()).done);r=!0){var c=i.value;t+="&field=".concat(c)}}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}var s=x._stateManager.queryObject();if(s.filter){var d=Object.keys(s.filter);if(0<d.length){var u=!0,m=!1,f=void 0;try{for(var h,p=d[Symbol.iterator]();!(u=(h=p.next()).done);u=!0){var g=h.value,v=s.filter[g],b=!0,y=!1,_=void 0;try{for(var w,C=v[Symbol.iterator]();!(b=(w=C.next()).done);b=!0){var E=w.value;t+="&filter=".concat(g,"_._").concat(E)}}catch(e){y=!0,_=e}finally{try{b||null==C.return||C.return()}finally{if(y)throw _}}}}catch(e){m=!0,f=e}finally{try{u||null==p.return||p.return()}finally{if(m)throw f}}}}var L=Object.keys(s.sort);L.length&&(t+="&sort=".concat(L[0],"_._").concat(s.sort[L[0]])),e.setAttribute("href",t)}else if(x._dataManager.dataIsComplete&&x._configuration.dataToDownload){var S;switch(k){case"CSV":S=le(x._configuration.dataToDownload,",");break;case"TSV":S=le(x._configuration.dataToDownload,"\t");break;case"JSON":S=JSON.stringify(x._configuration.dataToDownload)}e.setAttribute("href","data:text/".concat(k.toLowerCase(),";charset=utf-8,").concat(encodeURIComponent(S)))}else e.addEventListener("click",function(){alert("Sorry, the data is not ready for downloading.")});e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)}),e.appendChild(a),g.appendChild(e)},b=0,y=["CSV","TSV","JSON"];b<y.length;b++)v();h.appendChild(g)}var _=a.appendChild(document.createElement("div"));_.id=x._targetId+"-filter-section",_.classList.add("filter-section");var w=a.appendChild(document.createElement("div"));w.id=x._targetId+"-visualization-section",w.classList.add("visualization-section");var C=a.appendChild(document.createElement("div"));C.id=x._targetId+"-notification-section",C.classList.add("notification-section");var E=C.appendChild(document.createElement("div"));E.classList.add("progress-bar");var L=E.appendChild(document.createElement("div"));L.classList.add("progress-dot-wrapper");for(var S=0;S<3;S++){var k=L.appendChild(document.createElement("span"));k.classList.add("progress-dot"),k.classList.add("dot-num-".concat(S+1))}var T=C.appendChild(document.createElement("div"));T.classList.add("error-message"),T.classList.add("message-bar");var N=C.appendChild(document.createElement("div"));N.classList.add("alert-message"),N.classList.add("message-bar");var A=a.appendChild(document.createElement("table"));A.id=x._targetId+"-table-section",A.classList.add("table-section"),A.appendChild(document.createElement("caption")).appendChild(document.createTextNode(x._configuration.caption));var M=A.appendChild(document.createElement("thead")).appendChild(document.createElement("tr"));switch(M.classList.add("table-header-row"),x._configuration.stickyHeader&&M.classList.add("sticky-header"),x._configuration.firstColumnType){case"number":var I=M.appendChild(document.createElement("th"));I.innerHTML="#",I.classList.add("table-row-index-column"),I.style.width=6*(x._dataManager.cache.totalCount+"").length+24+"px";break;case"checkbox":var j=M.appendChild(document.createElement("input"));j.setAttribute("type","checkbox"),j.classList.add("table-row-index-column"),j.style.width="24px"}var P=!0,O=!1,F=void 0;try{for(var D,z=x._columnSetting.shownColumns[Symbol.iterator]();!(P=(D=z.next()).done);P=!0){var B=D.value,R=M.appendChild(document.createElement("th")),V=R.appendChild(document.createElement("span"));V.classList.add("table-row-regular-column-name"),V.appendChild(document.createTextNode(x._columnSetting.colModel[B].label)),V.setAttribute("aria-label",x._columnSetting.colModel[B].label);var H=x._columnSetting.colModel[B];if(H.width&&(R.style.width=H.width),H.tips){var q=R.appendChild(document.createElement("span"));q.classList.add("tooltiptext"),q.setAttribute("aria-label",H.tips),q.appendChild(document.createElement("span")).innerHTML=H.tips}H.sortable&&function(){V.classList.add("table-row-filter-column-name");var e=R.appendChild(document.createElement("div"));e.classList.add("table-sorting-control-container"),e._colName=B;var r=e.appendChild(document.createElement("i"));r.classList.add("table-sorting-control","table-sorting-up-control"),r._colName=B,r.setAttribute("role","button"),r.setAttribute("aria-label","sort in ascending order"),r.addEventListener("click",function(){for(var e=M.getElementsByClassName("table-sorting-control"),t=0,a=e.length;t<a;t++)e[t].classList.remove("table-sorting-control-active");r.classList.add("table-sorting-control-active"),x._sortOnColumn(r._colName,1)});var n=e.appendChild(document.createElement("i"));n.classList.add("table-sorting-control","table-sorting-down-control"),n._colName=B,n.setAttribute("role","button"),n.setAttribute("aria-label","sort in descending order"),n.addEventListener("click",function(){for(var e=M.getElementsByClassName("table-sorting-control"),t=0,a=e.length;t<a;t++)e[t].classList.remove("table-sorting-control-active");n.classList.add("table-sorting-control-active"),x._sortOnColumn(n._colName,-1)})}()}}catch(e){O=!0,F=e}finally{try{P||null==z.return||z.return()}finally{if(O)throw F}}if(A.appendChild(document.createElement("tbody")),x._configuration.pagination){var J=a.appendChild(document.createElement("div"));J.id=x._targetId+"-pager-section",J.classList.add("table-page-control-container");var U=J.appendChild(document.createElement("div"));U.classList.add("table-rows-per-page-control-container");var W=U.appendChild(document.createElement("label"));W.appendChild(document.createTextNode("Rows per page:"));var G=U.appendChild(document.createElement("select"));G.id=x._targetId+"-table-row-number-selector",W.setAttribute("for",G.id),G.classList.add("table-row-number-selector"),G.setAttribute("aria-label","showing ".concat(x._stateManager.rowsPerPage," rows per page"));for(var K=[5,10,20,50,100,200],Q=0,X=K;Q<X.length;Q++){var Y=X[Q];G.appendChild(document.createElement("option")).appendChild(document.createTextNode(Y+""))}G.selectedIndex=K.indexOf(x._stateManager.rowsPerPage),G.addEventListener("change",function(){this.setAttribute("aria-label","showing ".concat(this.value," rows per page")),x._updateRowsPerPage(+this.value)});var Z=J.appendChild(document.createElement("div"));Z.classList.add("table-page-number-control-container");var $=Z.appendChild(document.createElement("div"));$.classList.add("table-page-number-control-block","table-page-number-minus-one"),$.setAttribute("role","button"),$.setAttribute("aria-label","last page"),$.addEventListener("click",function(){x._setPageNumber(x._stateManager.currentPageNumber-1)});var ee=Z.appendChild(document.createElement("div"));ee.classList.add("table-page-number-current-container");var te=ee.appendChild(document.createElement("label"));te.appendChild(document.createTextNode("Page"));var ae=ee.appendChild(document.createElement("input"));ae.type="text",ae.id=x._targetId+"-table-page-number-current",te.setAttribute("for",ae.id),ae.setAttribute("aria-label","current page is 1"),ae.addEventListener("change",function(){var e=+this.value;isNaN(e)?alert("Invalid page number!"):x._setPageNumber(e)});var re=ee.appendChild(document.createElement("label"));re.appendChild(document.createTextNode("of"));var ne=ee.appendChild(document.createElement("input"));ne.type="text",ne.id=x._targetId+"-table-page-number-total",re.setAttribute("for",ne.id),ne.classList.add("table-page-number-total"),ne.readonly=!0;var oe=x._totalPages();ne.value=oe,ne.setAttribute("aria-label","all ".concat(oe," pages"));var ie=Z.appendChild(document.createElement("div"));ie.classList.add("table-page-number-control-block"),ie.classList.add("table-page-number-plus-one"),ie.setAttribute("role","button"),ie.setAttribute("aria-label","next page"),ie.addEventListener("click",function(){x._setPageNumber(x._stateManager.currentPageNumber+1)})}else x._stateManager.rowsPerPage=x._dataManager.cache.totalCount;t.appendChild(a),x._updateView().catch(function(e){console.error(e)}),x._configuration.layout.filter&&x._createFilterSection().catch(function(e){console.error(e)})}(this)}},{key:"_totalPages",value:function(){var e=Math.floor(this._dataManager.cache.totalCount/this._stateManager.rowsPerPage)+1;if(isNaN(e))throw"invalid total page number";return e}},{key:"_setPageNumber",value:function(e){e<1||e>this._totalPages()?alert("Page number out of range!"):(this._stateManager.currentPageNumber=e,this._updateView().catch(function(e){console.error(e.message)}))}},{key:"_updateRowsPerPage",value:function(e){this._stateManager.rowsPerPage=e,this._stateManager.currentPageNumber=1,this._updateView().catch(function(e){console.error(e.message)})}},{key:"_sortOnColumn",value:function(e,t){this._stateManager.sort={},this._stateManager.sort[e]=t,this._stateManager.currentPageNumber=1,this._updateView().catch(function(e){console.error(e.message)})}},{key:"_filterData",value:function(){var t=this;this._stateManager.currentPageNumber=1,this._updateView().then(function(){var e=document.getElementById(t._targetId+"-filter-viz-download-buttons-wrapper");Object.keys(t._stateManager.filter).length?e.classList.add("filter-active"):e.classList.remove("filter-active")}).catch(function(e){console.error(e.message)})}},{key:"_addColumn",value:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];for(var r=0,n=t;r<n.length;r++){var o=n[r];this._columnSetting.allColumns.includes(o)?this._columnSetting.shownColumns.includes(o)?console.error("column name ".concat(o," already in the shown list")):(this._columnSetting.shownColumns.push(o),this._columnSetting.hiddenColumns.splice(this._columnSetting.hiddenColumns.indexOf(o),1)):console.error("invalid column name ".concat(o," to add"))}}},{key:"_removeColumn",value:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];for(var r=0,n=t;r<n.length;r++){var o=n[r],i=this._columnSetting.shownColumns.indexOf(o);-1!==i?(this._columnSetting.shownColumns.splice(i,1),this._columnSetting.hiddenColumns.push(o)):console.error("invalid column name ".concat(o," to remove"))}}},{key:"_notifyStatus",value:function(e){!function(e,t){var a=document.getElementById(e+"-notification-section"),r=a.getElementsByClassName("message-bar");switch(t.type){case"progress":a.classList.add("progress-active"),a.classList.remove("error-active","alert-active");break;case"error":a.classList.add("error-active"),a.classList.remove("alert-active","progress-active"),r[0].innerText=t.message;break;case"alert":a.classList.add("alert-active"),a.classList.remove("error-active","progress-active"),r[1].innerText=t.message;break;case"success":a.classList.remove("progress-active"),a.classList.remove("error-active","alert-active");break;default:a.classList.remove("progress-active"),a.classList.remove("error-active","alert-active")}}(this._targetId,e)}},{key:"_updateView",value:function(){var t,a,r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return t=null,e.prev=1,this._notifyStatus({type:"progress",message:""}),e.next=5,regeneratorRuntime.awrap(this._dataManager.serve(this._stateManager.queryObject()));case 5:a=e.sent,t=a.data,e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(1),this._notifyStatus({type:"error",message:"failed to load data"}),e.t0;case 13:e.prev=13,r=this._totalPages(),i(this,t,r),this._notifyStatus({type:"success",message:""}),e.next=23;break;case 19:throw e.prev=19,e.t1=e.catch(13),this._notifyStatus({type:"error",message:"failed to update the view"}),e.t1;case 23:case"end":return e.stop()}},null,this,[[1,9],[13,19]])}},{key:"_createFilterSection",value:function(){var t,a,r,n,o,i,l,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return t=null,e.prev=1,e.next=4,regeneratorRuntime.awrap(this._dataManager.serve({facets:Object.keys(this._stateManager.filterStatus)}));case 4:t=e.sent,e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(1),this._notifyStatus({type:"error",message:"failed to create the filter section"}),e.t0;case 11:for(a={},n=!(r=!0),o=void 0,e.prev=15,i=t[Symbol.iterator]();!(r=(l=i.next()).done);r=!0)c=l.value,a[c.name]=c.facets;e.next=23;break;case 19:e.prev=19,e.t1=e.catch(15),n=!0,o=e.t1;case 23:e.prev=23,e.prev=24,r||null==i.return||i.return();case 26:if(e.prev=26,n)throw o;e.next=29;break;case 29:return e.finish(26);case 30:return e.finish(23);case 31:this._stateManager.filterStatus=a,e.prev=32,m(this),e.next=39;break;case 36:throw e.prev=36,e.t2=e.catch(32),e.t2;case 39:case"end":return e.stop()}},null,this,[[1,7],[15,19,23,31],[24,,26,30],[32,36]])}}]),r}()}();