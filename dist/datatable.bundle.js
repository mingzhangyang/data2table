var DataTable=function(){"use strict";const e=e=>{let t={colModel:{},allColumns:[]},a=new Set;for(let t of e){let e=Object.keys(t);for(let t of e)a.add(t)}for(let e of a)t.colModel[e]={name:e,label:e,tips:"",sortable:!1,hidden:!1,width:"",align:"",formatter:void 0},t.allColumns.push(e);return t.shownColumns=t.allColumns,t.hiddenColumns=[],t};function t(e,t){let a=new Map;for(let n of e){let e=n[t];"object"==typeof e&&(e=e.valueForFaceting);let o=a.get(e);void 0===o?a.set(e,1):a.set(e,o+1)}let n=[];for(let[e,t]of a)n.push({facetType:"value",facetValue:e,count:t});return n.sort((e,t)=>e.count>t.count?-1:e.count<t.count?1:e.facetValue>t.facetValue?-1:1),n}const a=function(e,a){let n=[];for(let o of a){let a={name:o};a.facets=t(e,o),n.push(a)}return n};function n(e,t){if(e===t)return!0;if(Object.prototype.toString.call(e)!==Object.prototype.toString.call(t))return!1;let a=Object.keys(e),o=Object.keys(t);if(a.length!==o.length)return!1;for(let o of a){let a=e[o],r=t[o];if(Object.prototype.toString.call(a)!==Object.prototype.toString.call(r))return!1;if("object"==typeof a){if(!n(a,r))return!1}else if(a!==r)return!1}return!0}const o=200,r=[5*o,4*o,3*o,2*o,o];class l{constructor(e,t){if(!Array.isArray(e))throw new TypeError("an array of objects expected");if("[object Object]"!==Object.prototype.toString.call(e[0]))throw new TypeError("an array of objects expected");if(this.dataIsComplete=t.dataIsComplete,this.dataIsComplete)this.data=e,this.batchSize=e.length,this.cache={data:this.data.slice(),queryObject:{filter:{},sort:{}},range:[0,this.batchSize],totalCount:e.length},this.fetchData=function(e){let t=e.start,a=e.limit,n=e.filter,o=e.sort,r=this.data.slice();if(n){let e=Object.keys(n);for(let t of e)r=Array.isArray(n[t])?r.filter(e=>"object"==typeof e[t]?n[t].includes(e[t].valueForFiltering):n[t].includes(e[t])):r.filter(e=>"object"==typeof e[t]?n[t]===e[t].valueForFiltering:n[t]===e[t])}if(o){let e=Object.keys(o)[0],t=o[e];1===t?r.sort((t,a)=>"object"==typeof t[e]&&"object"==typeof a[e]?t[e].valueForSorting<a[e].valueForSorting?-1:1:t[e]<a[e]?-1:1):-1===t&&r.sort((t,a)=>"object"==typeof t[e]&&"object"==typeof a[e]?t[e].valueForSorting<a[e].valueForSorting?1:-1:t[e]<a[e]?1:-1)}return{data:r.slice(t,t+a),totalCount:r.length}}.bind(this);else{if(e.length<o)throw`dataIsComplete is set false, but the provided dataset contains less than ${o} rows`;for(let t of r)if(e.length>=t){this.data=e.slice(0,t),this.batchSize=t,this.cache={data:this.data.slice(),queryObject:{filter:{},sort:{}},range:[0,this.batchSize]};break}if(!t.fetchData)throw"data is not complete, a fetchData function is required";if("function"!=typeof t.fetchData)throw new TypeError("fetchData should be a function");if(!t.totalCount)throw"data is not complete, a totalCount property indicating total rows is missing";this.fetchData=t.fetchData,this.cache.totalCount=t.totalCount}}async serve(e){if(Array.isArray(e.facets))return a(this.data,e.facets);let t=e.start?e.start:0,o=e.limit?e.limit:10,r=e.filter?e.filter:{},l=e.sort?e.sort:{};if(i=e,s=this.cache.queryObject,n(i.sort,s.sort)&&n(i.filter,s.filter)&&t>=this.cache.range[0]&&t<this.cache.range[1]){let e=t-this.cache.range[0];return{data:this.cache.data.slice(e,e+o),totalCount:this.cache.totalCount}}var i,s;let c=t-t%this.batchSize,d={start:c,limit:this.batchSize,filter:r,sort:l},u=null;try{u=await this.fetchData(d)}catch(e){throw e}this.cache.data=u.data,this.cache.queryObject=d,this.cache.range=[c,c+this.batchSize],this.cache.totalCount=u.totalCount;let m=t-c;return{data:this.cache.data.slice(m,m+o),totalCount:u.totalCount}}}class i{constructor(){this.rowsPerPage=10,this.currentPageNumber=1,this.sort={},this.filter={},this.filterStatus={}}extractFilter(){let e={},t=Object.keys(this.filterStatus);for(let a of t){let t=this.filterStatus[a].filter(e=>e.selected);t.length>0&&(e[a]=t.map(e=>e.facetValue))}return this.filter=e,e}getStart(){return(this.currentPageNumber-1)*this.rowsPerPage}queryObject(){return{start:(this.currentPageNumber-1)*this.rowsPerPage,limit:this.rowsPerPage,filter:this.extractFilter(),sort:this.sort}}}const s={highlight:function(e){return`<mark>${e}</mark>`},addLink:function(e){return`<a href="${e.link}">${e.text}</a>`},bold:function(e){return`<strong>${e}</strong>`},colorText:function(e){return`<span style="color: ${e.color}">${e.text}</span>`}};function c(e){return s[e]}function d(e,t=","){if(!Array.isArray(e))throw new TypeError("an array of objects expected");if(0===e.length)return"";let a=Object.keys(e[0]),n=a.map(e=>e.includes(t)?`"${e}"`:e).join(t)+"\n";for(let o of e){let e=a.map(e=>o[e]);n+=(e=e.map(e=>e.includes(t)?`"${e}"`:e)).join(t)+"\n"}return n}function u(e){switch(typeof e){case"number":return e+"";case"string":return e;case"boolean":return e+"";case"object":return Array.isArray(e)?e.join(", "):null===e?"N/A":JSON.stringify(e);default:return"N/A"}}return class{constructor(t,a,n={dataIsComplete:!0}){if("string"!=typeof a||!a)throw new TypeError("target id should be a non-empty string");this._targetId=a,this._dataManager=new l(t,n),this._stateManager=new i,this._columnSetting=e(this._dataManager.data),this._configuration={caption:"",maxNumOfFacets:50,layout:{download:!1,filter:!1,chart:!1,search:!1,column_selector:!1},firstColumnType:void 0,scheme:"default",fileName:n.fileName?n.fileName:"data",urlForDownloading:n.urlForDownloading,columnsToDownload:n.columnsToDownload,dataToDownload:n.dataToDownload,stickyHeader:n.stickyHeader,pagination:void 0===n.pagination||n.pagination},this._uid="my-1535567872393-product"}setRowsPerPage(e){if("number"!=typeof e||e<0)throw new Error("a natural number expected");if(![5,10,20,50,100,200].includes(e))throw`${e} is invalid`;this._stateManager.rowsPerPage=e}setFormatter(e,t){if("string"!=typeof e||!this._columnSetting.colModel[e])throw new Error(`Column name ${e} not recognized.`);if("string"!=typeof t){if("function"!=typeof t)throw new Error("A predefined formatter name or custom function expected.");this._columnSetting.colModel[e].formatter=t}else{let a=c[t];if(!a)throw new Error(`The formatter name ${t} not recognized.`);this._columnSetting.colModel[e].formatter=a}}configureColumn(e,t){if(!this._columnSetting.colModel[e])throw new Error("Column name not recognized.");if("object"!=typeof t)throw new Error("An object describing the column expected.");Object.assign(this._columnSetting.colModel[e],t)}configureLayout(e,t){if("string"!=typeof e)throw"Invalid property: "+e;switch(e.toUpperCase()){case"DOWNLOAD":this._configuration.layout.download=t;break;case"FILTER":this._configuration.layout.filter=t;break;case"CHART":this._configuration.layout.chart=t;break;case"SEARCH":this._configuration.layout.search=t;break;case"COLUMN_SELECTOR":this._configuration.layout.selectColumns=t;break;default:return console.error("Property not recognized!"),void console.error("Expect: download | search | filter | chart | column_selector")}console.log("Configuration updated.")}setShownColumns(e){let t=[];for(let a of e){if(!this._columnSetting.allColumns.includes(a))throw"invalid column name found when set shown columns";t.push(a)}this._columnSetting.shownColumns=t,this._columnSetting.hiddenColumns=this._columnSetting.allColumns.filter(e=>!t.includes(e))}addFilter(e,t="value"){if(!this._columnSetting.shownColumns.includes(e))throw`the column name ${e} is invalid`;this._stateManager.filterStatus[e]=[],this._configuration.layout.filter=!0}setCaption(e){"string"==typeof e&&e.length>0&&(this._configuration.caption=e)}setFirstColumnType(e,t){if("string"!=typeof e)throw new TypeError("a string expected to set the type of the first column");switch(e.toLowerCase()){case"number":this._configuration.firstColumnType="number";break;case"checkbox":this._configuration.firstColumnType="checkbox";break;case"image":if(this._configuration.firstColumnType="image","img"!==t.tagName)throw new TypeError("an img element descriptor expected");this._configuration.firstColumnFormatter=t.formatter;break;case"custom":this._configuration.firstColumnType="custom";let a=document.createElement(t.tagName);if("[object HTMLUnknownElement]"===Object.prototype.toString.call(a))throw"invalid tag name to create custom element";this._configuration.firstColumnFormatter=t.formatter;break;default:throw new TypeError("valid types: number, checkbox, image, custom")}}generate(){!function(e){let t=document.getElementById(e._targetId),a=document.createElement("div");t.parentNode.insertBefore(a,t),t.parentNode.removeChild(t),a.id=e._targetId,a.classList.add(e._uid,e._configuration.scheme),a.setAttribute("role","table");let n=document.createDocumentFragment(),o=n.appendChild(document.createElement("div"));if(o.classList.add("search-bar-panel"),e._configuration.search){let t=o.appendChild(document.createElement("div"));t.id=e._targetId+"-search-bar",t.classList.add("search-bar-wrapper");let a=t.appendChild(document.createElement("input"));a.type="search",a.id=e._targetId+"-search-box",a.classList.add("search-box"),a.setAttribute("aria-label","search box"),a.addEventListener("focus",function(){this.parentElement.classList.remove("search-hints-active")});let n=t.appendChild(document.createElement("label"));n.htmlFor=a.id,n.classList.add("label-for-search-box"),n.setAttribute("role","button"),n.setAttribute("aria-label","search button"),n.appendChild(document.createTextNode("Search"));let r=t.appendChild(document.createElement("span"));r.classList.add("question-mark"),r.setAttribute("role","button"),r.setAttribute("aria-label","hints for search syntax"),r.addEventListener("click",function(){this.parentElement.classList.add("search-hints-active")});let l=t.appendChild(document.createElement("div"));l.classList.add("search-hints-wrapper"),l.setAttribute("role","table");let i=l.appendChild(document.createElement("p"));i.innerText='Syntax: "column name":[[operator] value] [AND | OR] ["column name"[:[operator]value]]',i.setAttribute("role","row");let s=l.appendChild(document.createElement("p"));s.appendChild(document.createTextNode("e.g. ")),s.appendChild(document.createElement("span")).appendChild(document.createTextNode('"length": > 120')),s.appendChild(document.createElement("span")).appendChild(document.createTextNode(";")),s.appendChild(document.createElement("span")).appendChild(document.createTextNode('"height": 80 AND "width": 100')),s.setAttribute("role","row")}let r=n.appendChild(document.createElement("div"));if(r.id=e._targetId+"-filter-viz-download-buttons-wrapper",r.classList.add("filter-viz-download-buttons-wrapper"),e._configuration.filter){let t=r.appendChild(document.createElement("div"));t.classList.add("table-top-button","filter-section-control-button"),t.appendChild(document.createTextNode("Filters")),t.setAttribute("role","button"),t.setAttribute("aria-label","filter button"),t.addEventListener("click",function(){document.getElementById(e._targetId).classList.toggle("filter-section-active")})}if(e._configuration.chart){let t=r.appendChild(document.createElement("div"));t.classList.add("table-top-button"),t.classList.add("viz-section-control-button"),t.appendChild(document.createTextNode("Visualize")),t.addEventListener("click",function(){document.getElementById(e._targetId).classList.toggle("viz-section-active")})}if(e._configuration.download){let t=r.appendChild(document.createElement("div"));t.classList.add("table-top-button","download-control-button");let a=document.createElement("span");a.appendChild(document.createTextNode("Download")),t.appendChild(a),t.setAttribute("role","button"),t.setAttribute("aria-label","download button");let n=document.createElement("form");n.classList.add("data-table-download-type-options");for(let t of["CSV","TSV","JSON"]){let a=document.createElement("span"),o=a.appendChild(document.createElement("input"));o.type="radio",o.value=t,o.id=e._targetId+"-data-table-download-type-option-"+t,o.classList.add("data-table-download-type-option"),o.name="data-table-download-type",a.appendChild(o);let r=document.createElement("label");r.classList.add("data-table-download-type-option-label"),r.appendChild(document.createTextNode(t)),r.htmlFor="data-table-download-type-option "+t,r.addEventListener("click",()=>{let a=document.createElement("a");if(a.setAttribute("download",e._configuration.fileName+"."+t.toLowerCase()),e._configuration.urlForDownloading){let n=`${e._configuration.urlForDownloading}&type=${t.toLowerCase()}`,o=e._configuration.columnsToDownload?e._configuration.columnsToDownload:e._columnSetting.shownColumns;for(let e of o)n+=`&field=${e}`;let r=e._stateManager.queryObject();if(r.filter){let e=Object.keys(r.filter);if(e.length>0)for(let t of e){let e=r.filter[t];for(let a of e)n+=`&filter=${t}_._${a}`}}let l=Object.keys(r.sort);l.length&&(n+=`&sort=${l[0]}_._${r.sort[l[0]]}`),a.setAttribute("href",n)}else if(e._dataManager.dataIsComplete&&e._configuration.dataToDownload){let n;switch(t){case"CSV":n=d(e._configuration.dataToDownload,",");break;case"TSV":n=d(e._configuration.dataToDownload,"\t");break;case"JSON":n=JSON.stringify(e._configuration.dataToDownload)}a.setAttribute("href",`data:text/${t.toLowerCase()};charset=utf-8,${encodeURIComponent(n)}`)}else a.addEventListener("click",()=>{alert("Sorry, the data is not ready for downloading.")});a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}),a.appendChild(r),n.appendChild(a)}t.appendChild(n)}let l=n.appendChild(document.createElement("div"));l.id=e._targetId+"-filter-section",l.classList.add("filter-section");let i=n.appendChild(document.createElement("div"));i.id=e._targetId+"-visualization-section",i.classList.add("visualization-section");let s=n.appendChild(document.createElement("div"));s.id=e._targetId+"-notification-section",s.classList.add("notification-section");let c=s.appendChild(document.createElement("div"));c.classList.add("progress-bar");let u=c.appendChild(document.createElement("div"));u.classList.add("progress-dot-wrapper");for(let e=0;e<3;e++){let t=u.appendChild(document.createElement("span"));t.classList.add("progress-dot"),t.classList.add(`dot-num-${e+1}`)}let m=s.appendChild(document.createElement("div"));m.classList.add("error-message"),m.classList.add("message-bar");let h=s.appendChild(document.createElement("div"));h.classList.add("alert-message"),h.classList.add("message-bar");let p=n.appendChild(document.createElement("table"));p.id=e._targetId+"-table-section",p.classList.add("table-section"),p.appendChild(document.createElement("caption")).appendChild(document.createTextNode(e._configuration.caption));let f=p.appendChild(document.createElement("thead")).appendChild(document.createElement("tr"));switch(f.classList.add("table-header-row"),e._configuration.stickyHeader&&f.classList.add("sticky-header"),e._configuration.firstColumnType){case"number":let t=f.appendChild(document.createElement("th"));t.innerHTML="#",t.classList.add("table-row-index-column"),t.style.width=6*(e._dataManager.cache.totalCount+"").length+24+"px";break;case"checkbox":let a=f.appendChild(document.createElement("input"));a.setAttribute("type","checkbox"),a.classList.add("table-row-index-column"),a.style.width="24px"}for(let t of e._columnSetting.shownColumns){let a=f.appendChild(document.createElement("th")),n=a.appendChild(document.createElement("span"));n.classList.add("table-row-regular-column-name"),n.appendChild(document.createTextNode(e._columnSetting.colModel[t].label)),n.setAttribute("aria-label",e._columnSetting.colModel[t].label);let o=e._columnSetting.colModel[t];if(o.width&&(a.style.width=o.width),o.tips){let e=a.appendChild(document.createElement("span"));e.classList.add("tooltiptext"),e.setAttribute("aria-label",o.tips),e.appendChild(document.createElement("span")).innerHTML=o.tips}if(o.sortable){n.classList.add("table-row-filter-column-name");let o=a.appendChild(document.createElement("div"));o.classList.add("table-sorting-control-container"),o._colName=t;let r=o.appendChild(document.createElement("i"));r.classList.add("table-sorting-control","table-sorting-up-control"),r._colName=t,r.setAttribute("role","button"),r.setAttribute("aria-label","sort in ascending order"),r.addEventListener("click",function(){let t=f.getElementsByClassName("table-sorting-control");for(let e=0,a=t.length;e<a;e++)t[e].classList.remove("table-sorting-control-active");r.classList.add("table-sorting-control-active"),e._sortOnColumn(r._colName,1)});let l=o.appendChild(document.createElement("i"));l.classList.add("table-sorting-control","table-sorting-down-control"),l._colName=t,l.setAttribute("role","button"),l.setAttribute("aria-label","sort in descending order"),l.addEventListener("click",function(){let t=f.getElementsByClassName("table-sorting-control");for(let e=0,a=t.length;e<a;e++)t[e].classList.remove("table-sorting-control-active");l.classList.add("table-sorting-control-active"),e._sortOnColumn(l._colName,-1)})}}if(p.appendChild(document.createElement("tbody")),e._configuration.pagination){let t=n.appendChild(document.createElement("div"));t.id=e._targetId+"-pager-section",t.classList.add("table-page-control-container");let a=t.appendChild(document.createElement("div"));a.classList.add("table-rows-per-page-control-container");let o=a.appendChild(document.createElement("label"));o.appendChild(document.createTextNode("Rows per page:"));let r=a.appendChild(document.createElement("select"));r.id=e._targetId+"-table-row-number-selector",o.setAttribute("for",r.id),r.classList.add("table-row-number-selector"),r.setAttribute("aria-label",`showing ${e._stateManager.rowsPerPage} rows per page`);let l=[5,10,20,50,100,200];for(let e of l)r.appendChild(document.createElement("option")).appendChild(document.createTextNode(e+""));r.selectedIndex=l.indexOf(e._stateManager.rowsPerPage),r.addEventListener("change",function(){this.setAttribute("aria-label",`showing ${this.value} rows per page`),e._updateRowsPerPage(+this.value)});let i=t.appendChild(document.createElement("div"));i.classList.add("table-page-number-control-container");let s=i.appendChild(document.createElement("div"));s.classList.add("table-page-number-control-block","table-page-number-minus-one"),s.setAttribute("role","button"),s.setAttribute("aria-label","last page"),s.addEventListener("click",function(){e._setPageNumber(e._stateManager.currentPageNumber-1)});let c=i.appendChild(document.createElement("div"));c.classList.add("table-page-number-current-container");let d=c.appendChild(document.createElement("label"));d.appendChild(document.createTextNode("Page"));let u=c.appendChild(document.createElement("input"));u.type="text",u.id=e._targetId+"-table-page-number-current",d.setAttribute("for",u.id),u.setAttribute("aria-label","current page is 1"),u.addEventListener("change",function(){let t=+this.value;isNaN(t)?alert("Invalid page number!"):e._setPageNumber(t)});let m=c.appendChild(document.createElement("label"));m.appendChild(document.createTextNode("of"));let h=c.appendChild(document.createElement("input"));h.type="text",h.id=e._targetId+"-table-page-number-total",m.setAttribute("for",h.id),h.classList.add("table-page-number-total"),h.readonly=!0;let p=e._totalPages();h.value=p,h.setAttribute("aria-label",`all ${p} pages`);let f=i.appendChild(document.createElement("div"));f.classList.add("table-page-number-control-block"),f.classList.add("table-page-number-plus-one"),f.setAttribute("role","button"),f.setAttribute("aria-label","next page"),f.addEventListener("click",function(){e._setPageNumber(e._stateManager.currentPageNumber+1)})}else e._stateManager.rowsPerPage=e._dataManager.cache.totalCount;a.appendChild(n),e._updateView().catch(e=>{console.error(e)}),e._configuration.layout.filter&&e._createFilterSection().catch(e=>{console.error(e)})}(this)}_totalPages(){let e=Math.floor(this._dataManager.cache.totalCount/this._stateManager.rowsPerPage)+1;if(isNaN(e))throw"invalid total page number";return e}_setPageNumber(e){e<1||e>this._totalPages()?alert("Page number out of range!"):(this._stateManager.currentPageNumber=e,this._updateView().catch(e=>{console.error(e.message)}))}_updateRowsPerPage(e){this._stateManager.rowsPerPage=e,this._stateManager.currentPageNumber=1,this._updateView().catch(e=>{console.error(e.message)})}_sortOnColumn(e,t){this._stateManager.sort={},this._stateManager.sort[e]=t,this._stateManager.currentPageNumber=1,this._updateView().catch(e=>{console.error(e.message)})}_filterData(){this._stateManager.currentPageNumber=1,this._updateView().then(()=>{let e=document.getElementById(this._targetId+"-filter-viz-download-buttons-wrapper");Object.keys(this._stateManager.filter).length?e.classList.add("filter-active"):e.classList.remove("filter-active")}).catch(e=>{console.error(e.message)})}_addColumn(...e){for(let t of e)this._columnSetting.allColumns.includes(t)?this._columnSetting.shownColumns.includes(t)?console.error(`column name ${t} already in the shown list`):(this._columnSetting.shownColumns.push(t),this._columnSetting.hiddenColumns.splice(this._columnSetting.hiddenColumns.indexOf(t),1)):console.error(`invalid column name ${t} to add`)}_removeColumn(...e){for(let t of e){let e=this._columnSetting.shownColumns.indexOf(t);-1!==e?(this._columnSetting.shownColumns.splice(e,1),this._columnSetting.hiddenColumns.push(t)):console.error(`invalid column name ${t} to remove`)}}_notifyStatus(e){!function(e,t){let a=document.getElementById(e+"-notification-section"),n=a.getElementsByClassName("message-bar");switch(t.type){case"progress":a.classList.add("progress-active"),a.classList.remove("error-active","alert-active");break;case"error":a.classList.add("error-active"),a.classList.remove("alert-active","progress-active"),n[0].innerText=t.message;break;case"alert":a.classList.add("alert-active"),a.classList.remove("error-active","progress-active"),n[1].innerText=t.message;break;case"success":a.classList.remove("progress-active"),a.classList.remove("error-active","alert-active");break;default:a.classList.remove("progress-active"),a.classList.remove("error-active","alert-active")}}(this._targetId,e)}async _updateView(){let e=null;try{this._notifyStatus({type:"progress",message:""}),e=(await this._dataManager.serve(this._stateManager.queryObject())).data}catch(e){throw this._notifyStatus({type:"error",message:"failed to load data"}),e}try{!function(e,t,a){for(let t of e._columnSetting.shownColumns)if(e._columnSetting.colModel[t].formatter)if("string"==typeof e._columnSetting.colModel[t].formatter){if(!c(e._columnSetting.colModel[t].formatter))throw new Error("formatter not recognized");e._columnSetting.colModel[t].formatter=c(e._columnSetting.colModel[t].formatter)}else if("function"!=typeof e._columnSetting.colModel[t].formatter)throw new Error("Invalid formatter for "+t);if("string"!=typeof e._targetId||!e._targetId)throw new Error("an element id expected");let n=document.getElementById(e._targetId+"-table-section");if(!n)throw new Error("failed to locate the table");let o=n.getElementsByTagName("tbody")[0],r=o.lastChild;for(;r;)r._data=null,o.removeChild(r),r=o.lastChild;let l=document.createDocumentFragment();for(let a=0;a<t.length;a++){let n=t[a],o=l.appendChild(document.createElement("tr"));switch(o._data=n,e._configuration.firstColumnType){case"number":let t=e._stateManager.getStart()+1,r=o.appendChild(document.createElement("td"));r.innerText=t+a,r.classList.add("table-row-index-column");break;case"checkbox":o.appendChild(document.createElement("td")).classList.add("table-row-index-column","table-row-checkbox-column")}for(let t of e._columnSetting.shownColumns){let a=o.appendChild(document.createElement("td"));if(e._columnSetting.colModel[t].formatter){let o=e._columnSetting.colModel[t].formatter(n[t]);switch(typeof o){case"string":a.innerHTML=o;break;case"object":a.appendChild(o);break;default:a.innerText="invalid customized formatter"}}else a.innerText=u(n[t]);e._columnSetting.colModel[t].align&&(a.style.textAlign=e._columnSetting.colModel[t].align)}}if(o.appendChild(l),e._configuration.pagination){let t=document.getElementById(e._targetId+"-table-page-number-current");t.value=e._stateManager.currentPageNumber,t.setAttribute("aria-label","current page is "+t.value);let n=document.getElementById(e._targetId+"-table-page-number-total");n.value=a,n.setAttribute("aria-label",`all ${a} pages`)}}(this,e,this._totalPages()),this._notifyStatus({type:"success",message:""})}catch(e){throw this._notifyStatus({type:"error",message:"failed to update the view"}),e}}async _createFilterSection(){let e=null;try{e=await this._dataManager.serve({facets:Object.keys(this._stateManager.filterStatus)})}catch(e){throw this._notifyStatus({type:"error",message:"failed to create the filter section"}),e}let t={};for(let a of e)t[a.name]=a.facets;this._stateManager.filterStatus=t;try{!function(e){let t=document.getElementById(e._targetId+"-filter-section");if(!t)throw new Error("Creating filter section failed.");for(;t.lastChild;)t.removeChild(t.lastChild);let a=Object.keys(e._stateManager.filterStatus);if(0===a.length)return void console.error("No filters found.");let n=document.getElementById(e._targetId+"-filter-viz-download-buttons-wrapper");if(0===n.getElementsByClassName("filter-section-control-button").length){let t=n.insertBefore(document.createElement("div"),n.firstElementChild);t.classList.add("table-top-button","filter-section-control-button"),t.appendChild(document.createTextNode("Filters")),t.setAttribute("role","button"),t.setAttribute("aria-label","filter button"),t.addEventListener("click",function(){document.getElementById(e._targetId).classList.toggle("filter-section-active")}),t.classList.add("filter-ready-signal"),setTimeout(function(){t.classList.remove("filter-ready-signal")},2e3)}let o=document.createDocumentFragment(),r=o.appendChild(document.createElement("table"));r.classList.add("filter-section-table");for(let t of a){let a=r.appendChild(document.createElement("tr"));a.classList.add("filter-section-row"),a.filterName=t;let n=a.appendChild(document.createElement("td"));n.classList.add("filter-name"),n.appendChild(document.createTextNode(e._columnSetting.colModel[t].label?e._columnSetting.colModel[t].label:t)),(n=a.appendChild(document.createElement("td"))).classList.add("filter-values"),n.classList.add("unfold-fold-fold");for(let a=0;a<e._stateManager.filterStatus[t].length;a++){let o=e._stateManager.filterStatus[t][a],r=n.appendChild(document.createElement("span"));r.classList.add("filter-value"),a>9&&r.classList.add("filter-value-hidden");let l=r.appendChild(document.createElement("input"));l.type="checkbox";let i=`${e._targetId}-filter-value-${t}-value-${a}`;l.id=i,l.counterpart=o,l.addEventListener("change",function(){this.counterpart.selected=this.checked,e._filterData()});let s=r.appendChild(document.createElement("label"));if(s.setAttribute("for",i),s.appendChild(document.createTextNode(`${o.facetValue} (${o.count})`)),a>e._configuration.maxNumOfFacets-1){let t=n.appendChild(document.createElement("span"));t.classList.add("filter-value-hidden"),t.classList.add("filter-value-overflow-message"),t.innerText="(showing the first 50 items only)",e._notifyStatus({type:"alert",message:"Too many facets, only a partial list is shown in the Filter section"});break}}if(e._stateManager.filterStatus[t].length>10){let e=n.appendChild(document.createElement("span"));e.classList.add("unfold-fold-ctrl"),e.addEventListener("click",function(e){e.target.parentNode.classList.toggle("unfold-fold-fold")})}}t.appendChild(o)}(this)}catch(e){throw e}}}}();